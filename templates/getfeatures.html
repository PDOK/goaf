<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>BGT</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css"
          integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <!--<![endif]-->

    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            margin: 20px;
            background: #fafafa;
        }
    </style>

    <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css"
          type="text/css">
    <style>
        .map {
            height: 400px;
            width: 100%;
        }
    </style>
    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>


</head>
<body>

<h2>Feature Collection</h2>

<h3>Returned # {{.NumberReturned}}</h3>

<h3>Links</h3>
<table class="pure-table pure-table-bordered">
    <thead>
    <tr>
        <th>Title</th>
        <th>Content-Type</th>
        <th>Relation-Type</th>
        <th>Href</th>
    </tr>
    </thead>

    <tbody>
    {{range  $i, $link := .Links}}
        <tr {{if isOdd $i}}class="pure-table-odd" {{end}}>
            <td>{{$link.Title}}</td>
            <td>{{$link.Type}}</td>
            <td>{{$link.Rel}}</td>
            <td><a href="{{$link.Href}}"> {{$link.Href}} </a></td>
        </tr>
    {{end}}
    </tbody>
</table>

<h3>Map</h3>
<div id="map" class="map"></div>
<script type="text/javascript">
    // Geldigheidsgebied van het tiling schema in RD-coÃ¶rdinaten:
    var projectionExtent = [-285401.92, 22598.08, 595401.9199999999, 903401.9199999999];
    var projection = new ol.proj.Projection({code: 'EPSG:28992', units: 'm', extent: projectionExtent});
    // Resoluties (pixels per meter) van de zoomniveaus:
    var resolutions = [3440.640, 1720.320, 860.160, 430.080, 215.040, 107.520, 53.760, 26.880, 13.440, 6.720, 3.360, 1.680, 0.840, 0.420, 0.210];
    var size = ol.extent.getWidth(projectionExtent) / 256;
    // Er zijn 15 (0 tot 14) zoomniveaus beschikbaar van de WMTS-service voor de BRT-Achtergrondkaart:
    var matrixIds = new Array(15);
    for (var z = 0; z < 15; ++z) {
        matrixIds[z] = 'EPSG:28992:' + z;
    }

    //var geojsonData = '/collections/begroeidterreindeel/items?f=json&limit=100&offset=0'
    var geojsonData = {
        "numberReturned": 100, "type": "FeatureCollection", "features": [{
            "type": "Feature",
            "id": 1,
            "geometry": {
                "type": "Polygon",
                "coordinates": [[[5.57691424189758, 52.54148714951784], [5.576813387663471, 52.543269097106055], [5.576813387663471, 52.543269097106055], [5.576811606494033, 52.54330051939217], [5.576811606494033, 52.54330051939217], [5.572463251193488, 52.54320967367748], [5.572446368632987, 52.543198160417916], [5.572446368632987, 52.543198160417916], [5.572447847039542, 52.54317112445228], [5.572447847039542, 52.54317112445228], [5.572520975810333, 52.541831441990745], [5.572520975810333, 52.541831441990745], [5.572527778045473, 52.54170685002254], [5.5725393980898215, 52.54149406756359], [5.5725393980898215, 52.54149406756359], [5.572588024820907, 52.54060333639724], [5.572588024820907, 52.54060333639724], [5.5727546174455815, 52.540606868464586], [5.5727546174455815, 52.540606868464586], [5.576959022067503, 52.54069583967344], [5.576959022067503, 52.54069583967344], [5.57691424189758, 52.54148714951784]]]
            },
            "properties": {
                "LV-publicatiedatum": "2015-09-20T20:39:51Z",
                "_geometry_group": "polygon",
                "_id": "L0001.8ea3e922c1714b02a4eacd47a25bcc14",
                "_version": "a83fd69f-d1ae-11e7-951f-610a7ca84980",
                "bronhouder": "L0001",
                "creationDate": "2014-11-26T00:00:00Z",
                "fysiekVoorkomen": "bouwland",
                "fysiekVoorkomen_codeSpace": "http://www.geostandaarden.nl/imgeo/def/2.1#FysiekVoorkomenBegroeidTerrein",
                "gid": 331864,
                "inOnderzoek_leeg": "geenWaarde",
                "kruinlijn_leeg": "waardeOnbekend",
                "lokaalID": "L0001.8ea3e922c1714b02a4eacd47a25bcc14",
                "opTalud": "false",
                "plus-fysiekVoorkomen_codeSpace": "http://www.geostandaarden.nl/imgeo/def/2.1#VoidReasonValue",
                "plus-fysiekVoorkomen_leeg": "waardeOnbekend",
                "plus-status_codeSpace": "http://www.geostandaarden.nl/imgeo/def/2.1#VoidReasonValue",
                "plus-status_leeg": "geenWaarde",
                "relatieveHoogteligging": 0,
                "status": "bestaand",
                "status_codeSpace": "http://www.geostandaarden.nl/imgeo/def/2.1#Status",
                "terminationDate_leeg": "geenWaarde",
                "tijdstipRegistratie": "2014-11-26T11:35:15Z"
            },
            "links": [{
                "type": "application/json",
                "href": "http://localhost:8080/collections/begroeidterreindeel/items/1?f=json",
                "rel": "self",
                "title": "this feature in json format"
            }, {
                "type": "text/html",
                "href": "http://localhost:8080/collections/begroeidterreindeel/items/1?f=html",
                "rel": "alternate",
                "title": "alternate feature in html format"
            }]
        }]
    }

    var vector = new ol.layer.Vector({
        source: new ol.source.Vector({
            //  matrixSet: 'EPSG:28992',
            format: new ol.format.GeoJSON(),
            projection: 'WGS:84',
            url: '/collections/begroeidterreindeel/items?f=json&limit=100&offset=0',
            change: zoom2extent
        })
    });
    var map = new ol.Map({
        layers: [
            new ol.layer.Tile({
                opacity: 0.1,
                source: new ol.source.WMTS({
                    attributions: 'Kaartgegevens: &copy; <a href="https://www.kadaster.nl">Kadaster</a>',
                    url: 'https://geodata.nationaalgeoregister.nl/tiles/service/wmts?',
                    layer: 'brtachtergrondkaart',
                    matrixSet: 'EPSG:28992',
                    format: 'image/png',
                    projection: projection,
                    tileGrid: new ol.tilegrid.WMTS({
                        origin: ol.extent.getTopLeft(projectionExtent),
                        resolutions: resolutions,
                        matrixIds: matrixIds
                    }),
                    style: 'default',
                    wrapX: false
                })
            }),
            vector,
        ],
        target: 'map',
        controls: ol.control.defaults({
            attributionOptions: {
                collapsible: false
            }
        }),
        view: new ol.View({
            minZoom: 0,
            maxZoom: 15,
            projection: projection,
            center: [150000, 450000],
            zoom: 3
        })
    });

    function zoom2extent(event) { //the extent here should be dynamic
        var extent = vector.getExtent();
        map.getView().fit(extent, {duration: 1590}, map.getSize());
    }
</script>

<h3>Properties</h3>

{{ if  gt .NumberReturned  0 }}

    <table class="pure-table pure-table-bordered">
        <thead>
        <tr>
            <th>ID</th>
            {{$feature :=  index .Features 0}}
            {{range  $k, $v :=  $feature.Properties}}
                <th>{{$k}}</th>
            {{end}}

        </tr>
        </thead>

        <tbody>
        {{range  $i, $feature := .Features}}
            <tr {{if isOdd $i}}class="pure-table-odd" {{end}}>
                <td>{{$feature.ID}}</td>
                {{range  $k, $v :=  $feature.Properties}}
                    <td>{{$v}}</td>
                {{end}}
            </tr>
        {{end}}
        </tbody>
    </table>

{{ else }}
    <h4>No results</h4>
{{end}}


</body>
</html>